#! /bin/zsh

routesms_success=1701

# TODO: change this to actual directory
conf=etc/sms.conf

url=$(< $conf grep ^url= | cut -d'=' -f2)
username=$(< $conf grep ^username= | cut -d'=' -f2)
password=$(< $conf grep ^password= | cut -d'=' -f2)

destination=$1
message=$2

response=$(curl -s -X GET -G $url \
    --data-urlencode "username=$username" \
    --data-urlencode "password=$password" \
    --data-urlencode "type=0" \
    --data-urlencode "dlr=1" \
    --data-urlencode "destination=$destination" \
    --data-urlencode "source=Delaphone" \
    --data-urlencode "message=$2")

$code=$(print $response | cut -d'|' -f1)
if [[ $code -eq $routesms_success ]]; then
    exit 0
else
    print $code >&2
    exit 1
fi
